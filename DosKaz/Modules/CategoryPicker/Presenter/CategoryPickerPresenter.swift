//
//  CategoryPickerPresenter.swift
//  CategoryPicker
//
//  Generated by ModuleGenerator.
//  Copyright Â© 2020-02-24 12:15:36 +0000 lobster.kz. All rights reserved.
//

import SharedCodeFramework

enum CategoryPickerMode {
	case intro
	case settings
}
		
class CategoryPickerPresenter: CategoryPickerModuleInput {
	
	weak var view: CategoryPickerViewInput!
	var interactor: CategoryPickerInteractorInput!
	var router: CategoryPickerRouterInput!

	var mode: CategoryPickerMode = .intro
}

// MARK: ViewController output protocol

protocol CategoryPickerViewOutput {
	func initView(with mode: CategoryPickerMode)
	func viewIsReady()
}

extension CategoryPickerPresenter: CategoryPickerViewOutput {
	
	func initView(with mode: CategoryPickerMode) {
		self.mode = mode
	}
	
	func viewIsReady() {
		view.setupInitialState()
		let handicaps = DisabilityCategories().load()
		
		let categories = handicaps.map { handicap in
			return CategoryPickerViewController.Category(
				name: handicap.title,
				imageName: handicap.icon,
				onPickCategory: CommandWith<CategoryPickerViewController.Category> { [weak self] category in
					AppSettings.disabilitiesCategory = [handicap.key: handicap.categoryForAPI]
					guard let self = self else { return }
					switch self.mode {
					case .settings:
						self.router.pop(vc: self.view)
					case .intro:
						self.router.presentMainTabbar()						
					}
			})
		}
		
		view.update(with: categories)
	}

}


// MARK: Interactor output protocol

protocol CategoryPickerInteractorOutput: class {

}

extension CategoryPickerPresenter: CategoryPickerInteractorOutput {

}

